<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="stylesheet" href="./resources/ol.css" />
    <link rel="stylesheet" href="resources/fontawesome-all.min.css" />
    <link href="resources/photon-geocoder-autocomplete.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="./resources/ol-layerswitcher.css" />
    <link rel="stylesheet" href="./resources/qgis2web.css" />
    <style>
        html, body {
            background-color: #ffffff;
        }
        .ol-control > * {
            background-color: #f8f8f8 !important;
            color: #444444 !important;
            border-radius: 0px;
        }
        .ol-attribution a, .gcd-gl-input::placeholder, .search-layer-input-search::placeholder {
            color: #444444 !important;
        }
        .search-layer-input-search {
            background-color: #f8f8f8 !important;
        }
        .ol-control > *:focus, .ol-control > *:hover {
            background-color: rgba(248, 248, 248, 0.7) !important;
        }
        .ol-control {
            background-color: rgba(255, 255, 255, 0.4) !important;
            padding: 2px !important;
        }
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
    </style>
    <title>Map Popup Test</title>
</head>
<body>
    <div id="map">
        <div id="popup" class="ol-popup">
            <a href="#" id="popup-closer" class="ol-popup-closer"></a>
            <div id="popup-content"></div>
        </div>
    </div>

    <script src="resources/qgis2web_expressions.js"></script>
    <script src="./resources/functions.js"></script>
    <script src="./resources/ol.js"></script>
    <script src="./resources/ol-layerswitcher.js"></script>
    <script src="resources/photon-geocoder-autocomplete.min.js"></script>
    <script src="layers/DASPOS_1.js"></script>
    <script src="layers/DASSB_2.js"></script>
    <script src="layers/SungaiSaluran_WS_SB_Fix_3.js"></script>
    <script src="layers/SungaiSaluran_WS_POS_Fix_4.js"></script>
    <script src="layers/projectikan_5.js"></script>
    <script src="styles/DASPOS_1_style.js"></script>
    <script src="styles/DASSB_2_style.js"></script>
    <script src="styles/SungaiSaluran_WS_SB_Fix_3_style.js"></script>
    <script src="styles/SungaiSaluran_WS_POS_Fix_4_style.js"></script>
    <script src="styles/projectikan_5_style.js"></script>
    <script src="./layers/layers.js" type="text/javascript"></script>
    <script src="./resources/Autolinker.min.js"></script>
    <script src="./resources/qgis2web.js"></script>

    <script>
      // Popup fitur klik
      map.on('singleclick', function(evt) {
        const feature = map.forEachFeatureAtPixel(evt.pixel, function(f) {
          return f;
        });

        if (feature) {
          const props = feature.getProperties();
          console.log('Feature properties:', props); // debug cek properties di console

          let content = '<table style="border-collapse:collapse; width:100%;">';

          for (const key in props) {
            if (key !== 'geometry' && key !== 'foto') {
              content += `<tr><td style="padding:3px; border:1px solid #ccc; font-weight:bold; width:40%;">${key}</td><td style="padding:3px; border:1px solid #ccc;">${props[key]}</td></tr>`;
            }
          }

          content += '</table>';

          // Tampilkan foto jika ada
          if (props['foto']) {
            content += `<div style="margin-top:10px; text-align:center;">
              <img src="${props['foto']}" style="max-width:300px; width:100%; border:1px solid #ccc;">
              <div style="font-style:italic; color:#555; margin-top:5px;">Foto lokasi</div>''
            </div>`;
          }

          document.getElementById('popup-content').innerHTML = content;
          popup.setPosition(evt.coordinate);
          document.getElementById('popup').style.display = 'block';
        } else {
          document.getElementById('popup').style.display = 'none';
        }
      });

      // Tutup popup
      document.getElementById('popup-closer').onclick = function() {
        document.getElementById('popup').style.display = 'none';
        return false;
      };
    </script>
<!-- ðŸ§­ LEGENDA -->
<!-- ðŸ”° JUDUL WEBGIS DI POJOK KIRI ATAS -->
<div id="judul-webgis" style="
  position: absolute;
  top: 10px;
  left: 50px;
  z-index: 2000;
  background-color: white;
  padding: 8px 16px;
  font-size: 15px;
  font-weight: bold;
  border-radius: 5px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  pointer-events: none;
  color: #333;
">
  PETA PERSEBARAN PERENCANAAN BANGUNAN AIR BBWS SERAYU OPAK
</div>
<div id="legend" style="position: absolute; bottom:10px; left: 10px; z-index: 1000; background: white; padding: 10px; border-radius: 5px; font-size: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.3);">
  <b>Legenda</b><br>
  <div><span style="background-color: #af2fcf; width: 12px; height: 12px; display: inline-block; margin-right: 5px; border-radius: 50%;"></span> Tahun 2018</div>
  <div><span style="background-color: #d6e40f; width: 12px; height: 12px; display: inline-block; margin-right: 5px; border-radius: 50%;"></span> Tahun 2019</div>
  <div><span style="background-color: #2bec95; width: 12px; height: 12px; display: inline-block; margin-right: 5px; border-radius: 50%;"></span> Tahun 2020</div>
  <div><span style="background-color: #d41068; width: 12px; height: 12px; display: inline-block; margin-right: 5px; border-radius: 50%;"></span> Tahun 2021</div>
  <div><span style="background-color: #4baed8; width: 12px; height: 12px; display: inline-block; margin-right: 5px; border-radius: 50%;"></span> Tahun 2022</div>
  <div><span style="background-color: #4dd32f; width: 12px; height: 12px; display: inline-block; margin-right: 5px; border-radius: 50%;"></span> Tahun 2023</div>
  <div><span style="background-color: #5952e5; width: 12px; height: 12px; display: inline-block; margin-right: 5px; border-radius: 50%;"></span> Tahun 2024</div>
  <div><span style="background-color: #fb9a99; width: 12px; height: 12px; display: inline-block; margin-right: 5px;"></span> DAS Serayu - Bogowonto</div>
  <div><span style="background-color: #fb2872; width: 12px; height: 12px; display: inline-block; margin-right: 5px;"></span> DAS Progo - Opak - Serang</div>
  <div><span style="display: inline-block; width: 10px; height: 3px; background-color: #1426c8; margin-right: 5px;"></span> Saluran Sungai</div>
</div>

</body>
</html>
